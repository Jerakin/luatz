<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Daurnimator quae@daurnimator.com">
  <title>luatz</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">* {
-webkit-box-sizing: border-box;
-moz-box-sizing: border-box;
box-sizing: border-box
}
html,
body {
height: 100%
}
article,
aside,
figure,
footer,
header,
hgroup,
menu,
nav,
section {
display: block
}
body {
margin: 0
}
h1,
h2,
h3 {
margin: 1rem 0
}
h4,
h5,
h6,
ul,
ol,
dl,
blockquote,
address,
p,
figure {
margin: 0 0 1rem 0
}
img {
max-width: 100%
}
h1,
h2,
h3,
h4,
h5,
h6 {
font-weight: 700
}
h1 {
font-size: 2.5rem;
line-height: 3rem
}
h2 {
font-size: 1.5rem;
line-height: 2rem
}
h3 {
font-size: 1.25rem;
line-height: 1.5rem
}
h4,
h5,
h6 {
font-size: 1rem;
line-height: 1.25rem
}
hr {
border: 0;
border-bottom: 1px solid;
margin-top: -1px;
margin-bottom: 1rem
}
a:hover {
color: inherit
}
small {
font-size: .875rem
}
ul,
ol {
padding-left: 1rem
}
ul ul,
ul ol,
ol ol,
ol ul {
margin: 0
}
dt {
font-weight: 700
}
dd {
margin: 0
}
blockquote {
border-left: 1px solid;
padding-left: 1rem
}
address {
font-style: normal
}
html {
color: #333;
font: 100%/1.5 Avenir, 'Helvetica Neue', Helvetica, Arial, sans-serif;
-webkit-font-smoothing: antialiased;
-webkit-text-size-adjust: 100%;
-ms-text-size-adjust: 100%;
background: #FFF;
}
a {
color: #999;
text-decoration: none;
transition: color 0.3s;
}
a > h1,
a > h2,
a > h3 {
color: #333;
}
body > * {
padding: 0 1rem;
}
.subtitle {
font-size: 1rem;
line-height: 1.5rem
}
.author {
display: none
}
@media screen and (min-width: 55rem) {
.meta {
position: fixed;
width: 20rem;
height: 100%;
overflow: auto;
background: #FFF;
z-index: 1;
}
main {
display: block; 
margin-left: 20rem;
overflow: auto;
}
}
@media print {
section.level1 {
page-break-inside: avoid
}
nav a::after {
content: leader('.') target-counter(attr(href url), page, decimal)
}
}
</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="meta">
<header>
<h1 class="title">luatz</h1>
<h1 class="subtitle">A lua library for time and date manipulation</h1>
<h2 class="author">Daurnimator <a href="mailto:quae@daurnimator.com">quae@daurnimator.com</a></h2>
</header>
<nav id="TOC">
<ul>
<li><a href="#luatz"><code>luatz</code></a><ul>
<li><a href="#luatz.time"><code>time()</code> <!-- --></a></li>
<li><a href="#luatz.now"><code>now()</code> <!-- --></a></li>
<li><a href="#luatz.get_tz"><code>get_tz([timezone_name])</code> <!-- --></a></li>
<li><a href="#luatz.time_in"><code>time_in(timezone_name[, utc_ts])</code> <!-- --></a></li>
<li><a href="#luatz.gmtime"><code>gmtime(ts)</code> <!-- --></a></li>
<li><a href="#luatz.localtime"><code>localtime(ts)</code> <!-- --></a></li>
<li><a href="#luatz.ctime"><code>ctime(ts)</code> <!-- --></a></li>
</ul></li>
<li><a href="#gettime"><code>luatz.gettime</code> <!-- --></a><ul>
<li><a href="#gettime.source"><code>source</code> <!-- --></a></li>
<li><a href="#gettime.resolution"><code>resolution</code> <!-- --></a></li>
<li><a href="#gettime.gettime"><code>gettime()</code> <!-- --></a></li>
</ul></li>
<li><a href="#parse"><code>luatz.parse</code> <!-- --></a><ul>
<li><a href="#parse.rfc_3339"><code>rfc_3339(string[, init])</code> <!-- --></a></li>
</ul></li>
<li><a href="#timetable"><code>luatz.timetable</code> <!-- --></a><ul>
<li><a href="#timetable.new"><code>new(year, month, day, hour, min, sec[, yday[, [wday]])</code> <!-- --></a></li>
<li><a href="#timetable.new_from_timestamp"><code>new_from_timestamp(timestamp)</code> <!-- --></a></li>
<li><a href="#timetable:clone"><code>timetable:clone()</code> <!-- --></a></li>
<li><a href="#timetable:normalise"><code>timetable:normalise()</code> <!-- --></a></li>
<li><a href="#timetable:rfc_3339"><code>timetable:rfc_3339()</code> <!-- --></a></li>
<li><a href="#timetable:timestamp"><code>timetable:timestamp()</code> <!-- --></a></li>
<li><a href="#timetable:unpack"><code>timetable:unpack()</code> <!-- --></a></li>
</ul></li>
<li><a href="#tzinfo"><code>luatz.tzinfo</code> <!-- --></a><ul>
<li><a href="#tzinfo:find_current"><code>tzinfo:find_current(utc_ts)</code> <!-- --></a></li>
<li><a href="#tzinfo:localise"><code>tzinfo:localise(utc_ts)</code> and <code>tzinfo:localize(utc_ts)</code> <!-- --></a></li>
<li><a href="#tzinfo:utctime"><code>tzinfo:utctime(local_ts)</code> <!-- --></a></li>
</ul></li>
<li><a href="#links">Links</a></li>
</ul>
</nav>
</div>
<main>
<section id="luatz" class="level2">
<h2><code>luatz</code></h2>
<p>Requiring the base luatz module will give you a table of commonly used functions and submodules.</p>
<p>The table includes the following sub modules, which have their own documentation:</p>
<ul>
<li><a href="#parse"><code>parse</code></a>: Parses common date/time formats</li>
<li><a href="#timetable"><code>timetable</code></a>: Class for date/time objects supporting normalisation</li>
</ul>
<section id="luatz.time" class="level3">
<h3><code>time()</code> <!-- --></h3>
<p>Returns the current unix timestamp using the most precise source available. See <a href="#luatz.gettime"><code>gettime</code></a> for more information.</p>
</section>
<section id="luatz.now" class="level3">
<h3><code>now()</code> <!-- --></h3>
<p>Returns the current time as a timetable object See <code>timetable</code> for more information</p>
</section>
<section id="luatz.get_tz" class="level3">
<h3><code>get_tz([timezone_name])</code> <!-- --></h3>
<p>Returns a timezone object (see <code>tzinfo</code> documentation) for the given <code>timezone_name</code>. If <code>timezone_name</code> is <code>nil</code> then the local timezone is used. If <code>timezone_name</code> is an absolute path, then that <code>tzinfo</code> file is used</p>
<p>This uses the local <a href="https://www.iana.org/time-zones">zoneinfo database</a>; names are usually of the form <code>Country/Largest_City</code> e.g. “America/New_York”. Check <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">wikipedia</a> for an example list.</p>
</section>
<section id="luatz.time_in" class="level3">
<h3><code>time_in(timezone_name[, utc_ts])</code> <!-- --></h3>
<p>Returns the current time in seconds since 1970-01-01 0:00:00 in the given timezone as a string, (same semantics as <a href="#luatz.get_tz"><code>get_tz</code></a>) at the given UTC time (defaults to now).</p>
</section>
<section id="luatz.gmtime" class="level3">
<h3><code>gmtime(ts)</code> <!-- --></h3>
<p>As in the C standard library</p>
</section>
<section id="luatz.localtime" class="level3">
<h3><code>localtime(ts)</code> <!-- --></h3>
<p>As in the C standard library</p>
</section>
<section id="luatz.ctime" class="level3">
<h3><code>ctime(ts)</code> <!-- --></h3>
<p>As in the C standard library</p>
</section>
</section>
<section id="gettime" class="level2">
<h2><code>luatz.gettime</code> <!-- --></h2>
<p>A module to get the current time.</p>
<p>Uses the most precise method available (in order:)</p>
<ul>
<li>Use <a href="http://www.myriabit.com/ljsyscall/">ljsyscall</a> to access <code>clock_gettime(2)</code> called with <code>CLOCK_REALTIME</code></li>
<li><a href="http://25thandclement.com/~william/projects/lunix.html">lunix</a>’s <code>unix.clock_gettime()</code> (Only on non-Apple systems)</li>
<li>Use <a href="http://www.myriabit.com/ljsyscall/">ljsyscall</a> to access <code>gettimeofday(2)</code></li>
<li><a href="http://25thandclement.com/~william/projects/lunix.html">lunix</a>’s <code>unix.gettimeofday()</code></li>
<li><a href="http://w3.impa.br/~diego/software/luasocket/">luasocket</a>’s <code>socket.gettime</code></li>
<li><a href="http://openresty.org/">Openresty</a>’s <a href="http://wiki.nginx.org/HttpLuaModule#ngx.now"><code>ngx.now</code></a></li>
<li><a href="http://www.lua.org/manual/5.3/manual.html#pdf-os.time"><code>os.time</code></a></li>
</ul>
<section id="gettime.source" class="level3">
<h3><code>source</code> <!-- --></h3>
<p>The library/function currently in use by <a href="#gettime.gettime"><code>gettime()</code></a>.</p>
</section>
<section id="gettime.resolution" class="level3">
<h3><code>resolution</code> <!-- --></h3>
<p>The smallest time resolution (in seconds) available from <a href="#gettime.gettime"><code>gettime()</code></a>.</p>
</section>
<section id="gettime.gettime" class="level3">
<h3><code>gettime()</code> <!-- --></h3>
<p>Returns the number of seconds since unix epoch (1970-01-01T00:00:00Z) as a lua number</p>
</section>
</section>
<section id="parse" class="level2">
<h2><code>luatz.parse</code> <!-- --></h2>
<p>Provides parsers for common time and date formats.</p>
<p>Functions take the source string and an optional initial postition.</p>
<section id="parse.rfc_3339" class="level3">
<h3><code>rfc_3339(string[, init])</code> <!-- --></h3>
<p>If the string is a valid RFC-3339 timestamp, returns a luatz timetable and the (optional) time zone offset in seconds.</p>
<p>Otherwise returns <code>nil</code> and an error message</p>
</section>
</section>
<section id="timetable" class="level2">
<h2><code>luatz.timetable</code> <!-- --></h2>
<p>Provides an class to represent a time and date. Objects have no concept of timezone or utc offset.</p>
<p>The fields are intentionally compatible with the lua standard library’s <code>os.date</code> and <code>os.time</code>. Objects have fields:</p>
<ul>
<li><code>year</code></li>
<li><code>month</code></li>
<li><code>day</code></li>
<li><code>hour</code></li>
<li><code>min</code></li>
<li><code>sec</code></li>
<li><code>yday</code> (optional)</li>
<li><code>wday</code> (optional)</li>
</ul>
<p>timetable components may be outside of their standard range (e.g. a month component of 14) to facilitate arithmetic operations on date components. <code>:normalise()</code> can be called to modify components to return to their standard range.</p>
<p>Equality and comparisons should work between timetable objects.</p>
<section id="timetable.new" class="level3">
<h3><code>new(year, month, day, hour, min, sec[, yday[, [wday]])</code> <!-- --></h3>
<p>Returns a new timetable with the given contents.</p>
</section>
<section id="timetable.new_from_timestamp" class="level3">
<h3><code>new_from_timestamp(timestamp)</code> <!-- --></h3>
<p>Returns a new (normalised) timetable, given a timestamp in seconds since the unix epoch of 1970-01-01.</p>
</section>
<section id="timetable:clone" class="level3">
<h3><code>timetable:clone()</code> <!-- --></h3>
<p>Returns a new independent instance of an existing timetable object.</p>
</section>
<section id="timetable:normalise" class="level3">
<h3><code>timetable:normalise()</code> <!-- --></h3>
<p>Mutates the current object’s time and date components so that are integers within ‘normal’ ranges e.g. <code>month</code> is <code>1</code>-<code>12</code>; <code>min</code> is <code>0</code>-<code>59</code></p>
<p>First, fractional parts are propagated down.<br />
e.g. <code>.month=6.5</code> <code>.day=1</code> (which could be read as “the first day after the middle of June”) normalises to <code>.month=2</code> <code>.day=16</code></p>
<p>Second, any fields outside of their normal ranges are propagated up<br />
e.g. <code>.hour=10</code> <code>.min=100</code> (100 minutes past 10am) normalises to <code>.hour=11</code> <code>.min=40</code></p>
</section>
<section id="timetable:rfc_3339" class="level3">
<h3><code>timetable:rfc_3339()</code> <!-- --></h3>
<p>Returns the timetable formatted as an rfc-3339 style string. The timezone offset (or Z) is not appended. The ranges of components are not checked, if you want a valid timestamp, <a href="#timetable:normalise"><code>:normalise()</code></a> should be called first.</p>
<p>This function is also the <code>__tostring</code> metamethod for timetable objects</p>
</section>
<section id="timetable:timestamp" class="level3">
<h3><code>timetable:timestamp()</code> <!-- --></h3>
<p>Returns the timetable as the number of seconds since unix epoch (1970-01-01) as a lua number.</p>
</section>
<section id="timetable:unpack" class="level3">
<h3><code>timetable:unpack()</code> <!-- --></h3>
<p>Unpacks the timetable object; returns <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code>, <code>min</code>, <code>sec</code>, <code>yday</code>, <code>wday</code></p>
</section>
</section>
<section id="tzinfo" class="level2">
<h2><code>luatz.tzinfo</code> <!-- --></h2>
<p>Provides a metatable for the timezone class.</p>
<p>Created in <code>luatz.tzfile</code> and managed by <code>luatz.tzcache</code>; a timezone object contains information about a timezone. These objects are based on the information available in a “zoneinfo” file.</p>
<p>Timezone objects should be considered opaque and immutable; so the following details can be skipped over.</p>
<hr />
<p>The table contains a sequence of tables that describe the timezone at a given point using a <code>transition_time</code>: the unix timestamp (in UTC) that this definition starts, and a <code>tt_info</code> object.</p>
<p>A <code>tt_info</code> object contains information about a time offset; and contains the following fields:</p>
<ul>
<li><code>gmtoff</code> (number) The offset from GMT (UTC) in seconds</li>
<li><code>isdst</code> (boolean): If this change was declared as daylight savings</li>
<li><code>abbrind</code> (number, abbreviation id)</li>
<li><code>abbr</code> (string): short name for this gmt offset</li>
<li><code>isstd</code> (boolean)</li>
<li><code>isgmt</code> (boolean)</li>
</ul>
<section id="tzinfo:find_current" class="level3">
<h3><code>tzinfo:find_current(utc_ts)</code> <!-- --></h3>
<p>Returns the relevant <code>tt_info</code> object for the given UTC timestamp in the timezone.</p>
</section>
<section id="tzinfo:localise" class="level3">
<h3><code>tzinfo:localise(utc_ts)</code> and <code>tzinfo:localize(utc_ts)</code> <!-- --></h3>
<p>Convert the given UTC timestamp to the timezone. Returns the number of seconds since unix epoch in the given timezone.</p>
</section>
<section id="tzinfo:utctime" class="level3">
<h3><code>tzinfo:utctime(local_ts)</code> <!-- --></h3>
<p>Convert the given local timestamp (seconds since unix epoch in the time zone) to a UTC timestamp. This may result in ambigous results, in which case multiple values are returned.</p>
<p>e.g. consider that when daylight savings rewinds your local clock from 3am to 2am there will be two 2:30ams.</p>
</section>
</section>
<section id="links" class="level1">
<h1>Links</h1>
<ul>
<li><a href="https://github.com/daurnimator/luatz">Github</a></li>
<li><a href="https://github.com/daurnimator/luatz/issues">Issue tracker</a></li>
<li><a href="https://luarocks.org/modules/daurnimator/luatz">luarocks</a></li>
</ul>
</section>
</main>
</body>
</html>
